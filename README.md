# Micropython light alarm

New light hardware on ESP32/ Miropython and software for it.

boot.py - start initialization, SSID, password, MQTT-broker address

Выставить правильные пины для RGB, стробоскопа и белого света. Сейчас из-за особенностей отладочной доски для строба и белого 
используются пины красного и зеленого. Из-за этого после проверки в main.py пришлось закомментировать pwm для RGB

main.py - custom logic for control RGB light, main white light and alarm sireen by mqtt.

Обязательно раскомментировать строчки 180-182 для RGB PWM!!!

umqttsimple.py - some shit for MQTT functions, not to change. Found into Internet and used "as is".

Управляющая программа для "люстры" нового поколения. 

Управляющий топик - RGB и RGB/MAC-address. Ответы самого устройства в топике RGBASK/Mac-address. Ответ на пинг не реализован пока.

Формат фходной команды - JSON. Для RGB выглядит так:

{"RGB":"FF0000/3000/1000/00FF00/3000/2000/0000FF/3000/0/C"} 
         цвет1 вр.1 вр.2 цвет2 вр.1 вр.2 цвет3 вр.1 вр2 последовательность 
         
         Количество цветов в одной последвоательности произвольно.

Время 1 - время, сколько цвет находится "в статике" в миллисекундах. 0 не допускается. Для этого показателя допускается указание диапазона времени в милолсекундах через "-", например 100-1000 - это означает, что каждый раз время свечения выбираестя случайно в заданном диапазоне.

Время 2 - время "перехода" из одного цвета к следующему, меньще 1000 мс указывать не рекомендуется. Допустимо указывать 0 - мгновенная смена цвета.

Цвета обязательно указываются 6-значными 16-ричными значениями, скоращать нельзя.

Для дискретных каналов формат команды выглядит так:

{"STR":"1/3000/0/1000/C"} 

STR - в данном случае канал сирены, для белого света будет LGT.
1/3000/ - включить на 3000 миллисекунд.
0/0000/ - выключить на 1000 миллисекунд
С - продолжающаяся последовательность, S - однократно.

Правила задания рандомных промежутков времени такие же, как и для канала RGB.

В одной jSON-посылке допустимо передавать команды на все три канала устройства. 

Если в качестве команды в любой изх каналов устройства передано RESET(напр. {"STR":"RESET"}) - устройство уходит на пререзагрузку.

